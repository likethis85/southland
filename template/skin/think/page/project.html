<script language="javascript" type="text/javascript">
    var fillMember = function(data){
        $('#Developer ul').empty();
        $('#QA ul').empty();
        $('#Observer ul').empty();
        var members = new Array();
        for(i=0;i<data.length;i++){
            var member = null;
            for(j=0;j<members.length;j++){
                if(members[j].uid == data[i].uid) {
                    member = members[j];
                    break;
                }   
            }
            
            if(null==member) {
                member = new Object;
                member.uid = data[i].uid;
                member.nick = data[i].nick;
                member.role = new Array(/*'dev'*/new Array(),/*'qa'*/new Array(),/*'observer'*/new Array());
                members.push(member);
            }
        }
        $.each(data,function(i,item){
            $.each(members,function(j,mbr){
                if(mbr.uid==item.uid) {
                    switch(item.role) {
                    case '1':
                    case '4':
                    case '6':
                        mbr.role[0].push(item.role);
                        break;
                    case '2':
                    case '5':
                    case '7':
                        mbr.role[1].push(item.role);
                        break;
                    default:
                        mbr.role[2].push(item.role);
                        break;
                    }
                    mbr.role.push(item.role);
                }
            });
        });
        
        $.each(members,function(idx,item){
            $.each(item.role,function(i,role){
                if(role.length==0)
                    return;
                    
                var elem = "<li>"+item.nick;
                $.each(role,function(j,r){
                    switch(r) {
                    case '1':
                    case '2':
                        elem = elem+'[owner]';
                        break;
                    case '4':
                    case '5':
                        elem = elem+'[manager]';
                        break;
                    case '6':
                    case '7':
                        elem = elem+'[member]';
                        break;
                    }
                });
                elem = elem+"</li>";
                
                if(i==0)
                    $('#Developer ul').append(elem);
                else if(i==1)
                    $('#QA ul').append(elem);
                else if(i==2)
                    $('#Observer ul').append(elem);
            });
        });
    }
    $(document).ready(function(){
        $("#Del").click(function(){
            return confirm('<{T w="Confirm?"}>'+$(this).html());
        });
        
        $("#btn-PAU").click(function() {
            $.getJSON('ajax.php?a=gpm',function(data){
                fillMember(data);
                $('#AddUserPage').modal();
            });
        });
        
        $("a.tab").click(function () {
			$(".active").removeClass("active");
			$(this).addClass("active");
			$(".tab_content").slideUp();
			var content_show = $(this).attr("title");
			$("#"+content_show).slideDown();
		  
		});

        $("#PAU").click(function(){
            var url = "/ajax.php?a=pau&pid=<{$tProject.id}>&to="+$("a.tab.active").attr('title')+"&u="+escape($("#pauemail").attr('value'));
            $.getJSON(url,function(data) {
                fillMember(data);
            });
        });
    });
</script>
<div id="AddUserPage" style="display:none;">
    <h3><{T w="ProjectAddUser"}></h3>
    <table>
        <tr>
            <td>Email:</td>
            <td><input id="pauemail" type="text" size=40></td>
            <td>
                <div id="PAU" style="margin-left:8px;border:1px solid #494e52;height:22px;padding-left:3px;padding-right:3px;cursor:pointer;" align="center"><{T w='ProjectMemberAdd'}></div>
            </td>
        </tr>
    </table>
    <div id="tabbed_box_1" class="tabbed_box">
        <div class="tabbed_area">
            <ul class="tabs">
                <li><a href="#" title="Developer" class="tab active"><{T w='Developer'}></a></li>
                <li><a href="#" title="QA" class="tab"><{T w='QA'}></a></li>
                <li><a href="#" title="Observer" class="tab"><{T w='Observer'}></a></li>
            </ul>
            <div id="Developer" class="tab_content">
            	<ul>
    			</ul>
            </div>
            <div id="QA" class="tab_content">
            	<ul>
    			</ul>
            </div>
            <div id="Observer" class="tab_content">
            	<ul>
    			</ul>
            </div>
        </div>
    </div>
</div>
<div style="margin-left:36px;margin-top:16px;border-right:#c3daf9 1px solid;overflow:none;width:20%;float:left;">
	<table>
		<tr><td><h2><{T w="ProjectAuthor"}></h2></td></tr>
		<tr><td><div title="<{$tProject.uid.email}>"><{$tProject.uid.nick}></td></tr>
		<tr><td><h2><{T w="ProjectCreateTime"}></h2></td></tr>
		<tr><td><{$tProject.addtime}></td></tr>
		<tr><td><h2><{T w="ProjectOperator"}></h2></td></tr>
        <tr><td><div class="btn-capsule"><a id="btn-PAU" href="#"><{T w="ProjectAddUser"}></a></div></td></tr>
        <tr><td><div class="btn-capsule"><a href="/project.php?&a=update&id=<{$tCurrProj}>"><{T w="EditProject"}></a></div></td></tr>
        <tr><td><div class="btn-capsule"><a id="Del" href="/project.php?a=del&id=<{$tCurrProj}>"><{T w="DeleteProject"}></a></div></td></tr>
	</table>
</div>
<div style="margin-top:16px;float:left;margin-left:12px;width:70%">
	<{$tProject.description}>	
</div>
