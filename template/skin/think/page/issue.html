<div class="box_page">
    <script language="javascript" type="text/javascript">
    $.fn.dataTableExt.afnSortData['iStatus'] = function  ( oSettings, iColumn ){
        var aData = [];
        $( 'td:eq('+iColumn+')>img', oSettings.oApi._fnGetTrNodes(oSettings) ).each( function () {
            aData.push( this.src );
        });
        return aData;
    }
    $(document).ready(function(){
        $('#issues').dataTable({
            "bJQueryUI":true,
            "sPaginationType":"full_numbers",
            "aoColumns" : [
                null,
                {"sSortDataType": "iStatus", "sType": "string" },
                null,
                null,
                null,
                null
            ]
        });
        <{foreach item=item from=$tIssues}>
        $('#i<{$item.id}>').each(function(i,e){
            $(e).HoverMenu({
                'item' : <{spIssueOperation issue=$item}>,
                onSelect: function(e, item){
                    if(item.caption=='<{T w="IssuePost"}>'){
                        var bb = new BlackBox();
                        bb.popup('<div style="width:300px;">'+
                                    '<div id="close" class="close">x</div>'+
                                    '<form id="cp" action="/issue.php?a=post&id='+e.id.replace("i","")+'" method="post"><h3><{T w="IssuePost"}></h3>'+
                                    '<div id="projects" style="width:100%"></div>'+
                                    '<div class="btn-rounded" onclick="javascript:cp.submit();"><{T w="Submit"}></div>'+
                                    '</form>'+
                                 '</div>',
                            function(content) {
                                content.find('#close').click(function(){
                                    bb.boxClose();
                                });

                                $.getJSON("/ajax.php?a=GetAllProjects",function(json) {
                                    if(json.error != 0)
                                        alert(json.msg);
                                    else {
                                        var select = '<select name="prj" style="width:100%;">';
                                        for(var i=0;i<json.data.length;i++){
                                            select += '<option value="'+json.data[i].id+'">'+json.data[i].title+'</option>';
                                        }
                                        select += '</select>';
                                        content.find('#projects').append($(select));
                                    }
                                });
                            }
                        ); 
                    }
                }
            })
        });
        <{/foreach}>
    });
    </script>
    <div class="page_op">
        <table align="left" cellpadding="0" cellspacing="0">
            <tr>
                <td><a class="btn-capsule" href="issue.php?a=add"><{T w="NewIssues"}></a></td>
            </tr>
        </table>

    </div>
    <table id="issues" class="display" style="line-height:108%;">
        <thead>
            <tr>
                <th>ID</th>
                <th><{T w="IssueStatus"}></th>
                <th><{T w="IssueTitle"}></th>
                <th><{T w="IssueReporter"}></th>
                <th><{T w="IssueOwner"}></th>
                <th><{T w="IssueDate"}></th>
            </tr>
        </thead>
        <tbody>
            <{foreach item=itemI from=$tIssues}>
            <tr>
                <td><{$itemI.id}></td>
                <td>
                    <div id="i<{$itemI.id}>"></div>
                    <{if $itemI.status==1}>
                    <img src="<{$skinpath}>/img/open.png" width=16 height=16>
                    <{elseif $itemI.status==2}>
                    <img src="<{$skinpath}>/img/fixed.png" width=16 height=16>
                    <{else}>
                    <img src="<{$skinpath}>/img/open.png" width=16 height=16>
                    <{/if}>
                </td>
                <td><a href="/issue.php?a=view&id=<{$itemI.id}>"><{$itemI.brief}></a></td>
                <td><{spIssueReporter issue=$item}></td>
                <td><{spIssueOwner issue=$item}></td>
                <td><{$itemI.addtime}></td>
            </tr>
            <{/foreach}>
        </tbody>
    </table>
</div>
