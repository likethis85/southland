<div class="box_page">
    <script language="javascript" type="text/javascript">
        $.fn.dataTableExt.afnSortData['iStatus'] = function  ( oSettings, iColumn ){
            var aData = [];
            $( 'td:eq('+iColumn+')>img', oSettings.oApi._fnGetTrNodes(oSettings) ).each( function () {
                aData.push( this.src );
            });
            return aData;
        }
        $().ready(function(){
            $('#tasks').dataTable({
                "bJQueryUI":true,
                "sPaginationType":"full_numbers",
                "oLanguage":{
                    "sLengthMenu": "每页显示_MENU_记录",
                    "sZeroRecords": "暂无记录",
                    "sInfo":"共_TOTAL_页",
                    "sInfoEmpty":"",
                    "sInfoFiltered":"",
                    "sSearch" : "过滤",
                    "oPaginate": {
                        "sFirst": "第一页",
                        "sNext": "下一页",
                        "sPrevious": "上一页",
                        "sLast": "最后一页"
                      }
                },
                "aoColumns" : [
                    {"sSortDataType": "iStatus", "sType": "string" },
                    {"sSortDataType": "iStatus", "sType": "string" },
                    null
                ]
            });           
            <{foreach item=item from=$tTasks}>
            $('#t<{$item.id}>').each(function(i,e){
                $(e).HoverMenu({
                    'item' : <{spTaskOperation task=$item}>,
                    onSelect: function(e, item){
                        if(item.caption=='<{T w="PostTask"}>'){
                            var bb = new BlackBox();
                            bb.popup('<div style="width:300px;">'+
                                        '<div id="close" class="close">x</div>'+
                                        '<form id="cp" action="/task.php?a=post&id='+e.id.replace("t","")+'" method="post"><h3><{T w="PostTask"}></h3>'+
                                        '<div id="projects" style="width:100%"></div>'+
                                        '<div class="btn-rounded" onclick="javascript:cp.submit();"><{T w="Submit"}></div>'+
                                        '</form>'+
                                     '</div>',
                                function(content) {
                                    content.find('#close').click(function(){
                                        bb.boxClose();
                                    });

                                    $.getJSON("/ajax.php?a=GetAllProjects",function(json) {
                                        if(json.error != 0)
                                            alert(json.msg);
                                        else {
                                            var select = '<select name="prj" style="width:100%;">';
                                            for(var i=0;i<json.data.length;i++){
                                                select += '<option value="'+json.data[i].id+'">'+json.data[i].title+'</option>';
                                            }
                                            select += '</select>';
                                            content.find('#projects').append($(select));
                                        }
                                    });
                                }
                            ); 
                        }
                    }
                });
            });
            <{/foreach}>
        });
    </script>
    <div class="page_op">
        <table align="left" cellpadding="0" cellspacing="0">
            <tr>
                <td><a class="btn-capsule" href="/task.php?c=main&a=add&id=0"><{T w='AddTask'}></a></td>
            </tr>
        </table>
        <div style="clear:both;"></div>
    </div>
    <table id="tasks" class="display">
        <thead>
            <tr>
                <th width="88"><{T w="TaskStatus"}></th>
                <th width="88"><{T w="TaskPriority"}></th>
                <th><{T w="TaskTitle"}></th>
            </tr>
        </thead>
        <tbody>
            <{foreach item=item from=$tTasks}>
            <tr>
                <td width=22>
                    <div id="t<{$item.id}>"></div>
                    <{if $item.status eq 1}>
                    <img src="<{$skinpath}>/img/working.png" width=16 height=16>
                    <{elseif $item.status eq 2}>
                    <img src="<{$skinpath}>/img/codecompleted.png" width=16 height=16>
                    <{elseif $item.status eq 3}>
                    <img src="<{$skinpath}>/img/verified.png" width=16 height=16>
                    <{elseif $item.status eq 4}>
                    <img src="<{$skinpath}>/img/completed.png" width=16 height=16>
                    <{else}>
                    <img src="<{$skinpath}>/img/pending.png" width=16 height=16>
                    <{/if}>
                </td>
                <td width=22>
                    <{if $item.priority eq 1}><img src="<{$skinpath}>/img/1.gif"/><{/if}>
                    <{if $item.priority eq 2}><img src="<{$skinpath}>/img/2.gif"/><{/if}>
                    <{if $item.priority gt 2}><img src="<{$skinpath}>/img/3.gif"/><{/if}>
                </td>
                <td>
                    <a href="/task.php?c=main&a=view&id=<{$item.id}>"><{$item.subject}></a>
                </td>
            </tr>
            <{/foreach}>
        </tbody>
    </table>
</div>
