<{include file=skin/$skin/header.html}>
<script type="text/javascript">
    var memberColor = {};
    var memberCount =  0;
$.extend({
    getColor:function(usr){
        var colors = new Array("#FFB5B5","#FFAAD5","#FF77FF","#E6CAFF","#84C1FF","#BBFFFF", "#96FED1", "#A6FFA6");
        if(usr in memberColor)
          return memberColor[usr];
        else {
            memberCount++;
            memberColor[usr] = colors[memberCount % colors.length];
            return  memberColor[usr];
        }
    }
});
$(document).ready(function(){
	UE.getEditor('reply',{
        <{if $tUser.id==0}>
        initialContent: '<center><div class="btn-rounded" style="margin-top:64px;">回复前先登录</div></center>',
        <{/if}>
    })<{if $tUser.id==0}>.ready(function(){this.disable();})<{/if}>;

	$("#form").submit(function(){
	    UE.getEditor('reply').sync();    
	})
	.validate({
		rules:{
			reply: {required:true}
		}
	});
	
	$(".btn-rounded").hover(
        function(){ $(this).css('color','red');}, 
        function(){ $(this).css('color','white');}
    );

    $('div.comment').each(function(i,e){
        if(e.offsetHeight>200){
            $(e).addClass('comment-collapse')
            .find('div.comment-ce').show()
            .css({'cursor':'pointer'})
            .click(function(){
                if($(this).text()=='[-]'){
                    $(this).text('[+]');
                    $(e).addClass('comment-collapse');
                } else {
                    $(this).text('[-]');
                    $(e).removeClass('comment-collapse');
                }
            });
        }
    });

    $('.tmbr').each(function(){
        $(this).css('background-color',$.getColor(this.id));
    })
    $('.cmt').each(function(){
        $(this).css('background-color',$.getColor(this.id));
    });
});
</script>
<div class="page_content">
    <table width=100%>
        <tr>
            <td colspan=2>
                <div style="border-bottom:2px solid #E0E0E0;min-height:88px;">
                    <h1 class="title"><{$tRow.subject}></h1>
                    <{foreach item=member from=$tMembers}>
                    <div class="tmbr" id="t<{$member.id}>" style="float:left;margin-right:3px;padding:3px;">
                    <img src="<{$member.avatar}>" alt="<{$member.nick}>" title="<{$member.nick}>" width=32 height=32 />
                    </div>
                    <{/foreach}>
            </div>
            </td>
        </tr>

        <tr>
            <td valign="top" width=50%>
                <div>
                    <{$tRow.content}>
                </div>
            </td> 
            <td>
                <table>
                    <tr>
                        <td>
                            <div>
                                <{foreach item=item from=$tComments}>
                                <div class="comment">
                                    <table width=100%>
                                        <tr>
                                            <td colspan=2 style="background:#C2D5F5;">
                                                <{$item.user.nick}>&nbsp;&nbsp;<{T w="Posted On"}>&nbsp;&nbsp;<{$item.addtime}>
                                                <div class='comment-ce'>[+]</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="width:32px;" valign='top'><img src="<{$item.user.avatar}>"></td>
                                            <td style="padding-left:8px;">
                                                <table><tr><td>
                                                <div class="cmt" id="t<{$item.user.id}>"><{$item.content}></div>
                                                </td></tr></table>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <{/foreach}>
                            </div>
                            <div style="width:600px;">
                                <form id="form" method="post" action="/forum.php?a=cmt&id=<{$tRow.id}>">
                                    <div style="margin-top:32px;">
                                        <input class="btn-rounded" type=submit value="<{T w='Reply'}>">
                                        <textarea id="reply" name="reply"></textarea>
                                    </div>
                                    <input name="submitreply" type="hidden" id="submitreply" value="1" />
                                </form>
                            </div>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>
<{include file=skin/$skin/footer.html}>
